<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Zoo | Aryaman Arora</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <style>
        .tooltip {
            position: absolute;
            padding: 1em;
        }

        .tooltip p {
            margin: 0;
            padding: 0;
        }

        .tooltip table {
            margin: 0;
            padding: 0;
            border-collapse: collapse;
        }
    </style>
</head>
<body>
    <div id="graph"></div>
    <script>
        const parseDate = d3.timeParse("%B %d, %Y");
        const width = window.innerWidth, height = window.innerHeight
        const margin = {bottom: 50, left: 40, top: 0}
        const tooltip_width = 300

        var tooltip = d3.select("#graph").append("div")
            .attr("class", "card title shadow text-white bg-dark mt-3 mr-3 tooltip")
            .style("opacity", 0)
            .style("width", tooltip_width + "px")
            .style("right", -1000 + "px")
            .style("top", -1000 + "px")

        // color scale
        var color = d3.scaleOrdinal(d3.schemeCategory10)
            .domain(["Encoder-Decoder", "Encoder", "Decoder"])

        // load data
        d3.json("data.json").then(function (data) {

            data = data[0]

            // clean data columns
            data.forEach(function(d) {

                // parse dates
                d.announced_parsed = parseDate(d.announced);

                // parse model sizes
                if (d.parameters.slice(-1) === 'B') {
                    d.parameters_parsed = parseFloat(d.parameters.slice(0, -1)) * 1E9
                }
                else if (d.parameters.slice(-1) === 'M') {
                    d.parameters_parsed = parseFloat(d.parameters.slice(0, -1)) * 1E6
                }
                
                if (typeof d.languages === "object") {
                    d.languages_parsed = `Multilingual<sup>${d.languages.human}</sup> + Code<sup>${d.languages.code}</sup>`
                }
                else if (typeof d.languages === "array") {
                    d.languages_parsed = d.languages.join(" + ")
                }
                else if (!isNaN(parseInt(d.languages))) {
                    d.languages_parsed = `Multilingual<sup>${d.languages}</sup>`
                }
                else d.languages_parsed = d.languages

                if (typeof d.creator === "array") d.creator_parsed = d.creator.join(", ")
                else d.creator_parsed = d.creator
            });

            console.log(data)

            // make svg
            var svg = d3.select("#graph")
                .append("svg")
                    .attr("preserveAspectRatio", "xMidYMid")
                    .attr("viewBox", "0 0 " + width + " " + height)
                .append("g")
                    .attr("transform",
                        "translate(" + margin.left + "," + margin.top + ")");

            // axes
            var x = d3.scaleTime()
                .domain([new Date("2018-01-01"), new Date("2023-06-01")])
                .range([0, width - margin.left]);

            svg.append("g")
                .attr("transform", "translate(0," + (height - margin.bottom) + ")")
                .call(d3.axisBottom(x));

            var y = d3.scaleLog()
                .domain([5e5, 2e12])
                .range([height - margin.bottom, 0]);

            svg.append("g")
                .call(d3.axisLeft(y));
            

            function generate_tooltip(d) {
                var access_color = d.access === "Yes" ? d3.schemeCategory10[2] : (d.access === "No" ? d3.schemeCategory10[3] : d3.schemeCategory10[1])
                return `
                    <h2>${d.name}</h2>
                    <table class="table table-light table-bordered table-sm" style="max-width: 100%;">
                        <tr><th>Type</th><td style="color: white; background-color: ${color(d.type)}"><strong>${d.type}</strong></td></tr>
                        <tr><th>Announced</th><td>${d.announced}</td></tr>
                        <tr><th>Creator(s)</th><td>${d.creator_parsed}</td></tr>
                        <tr><th>Parameters</th><td>${d.parameters}</td></tr>
                        <tr><th>Languages</th><td>${d.languages_parsed}</td></tr>
                        <tr><th>Trained on</th><td>${d.trained_on}</td></tr>
                        <tr><th>Access</th><td style="color: white; background-color: ${access_color}">${d.access}</td></tr>
                    </table>
                `
            }

            // dots for each model
            svg.append('g')
                .selectAll("dot")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", d => x(d.announced_parsed) )
                .attr("cy", d => y(d.parameters_parsed) )
                .attr("r", 5)
                .style("fill", d => color(d.type))
                .on("mouseover", function(e, d) {
                    console.log(e)
                    d3.selectAll("circle")
                        .style("opacity", 0.2)
                    d3.select(this)
                        .style("opacity", 1)
                    focused = true

                    tooltip.style("left", Math.min(width - tooltip_width - 10, e.pageX + 20) + "px")
                        .style("top", Math.min(500, e.pageY) + "px")
                    tooltip.html(generate_tooltip(d))
                    tooltip.transition()
                        .duration(100)
                        .style("opacity", 1)
                })
                .on("mouseout", function (e, d) {
                    d3.selectAll("circle")
                        .style("opacity", 1)
                    focused = false
                    tooltip.style("opacity", 0)
                        .style("right", -1000 + "px")
                        .style("top", -1000 + "px")
                })

        })
    </script>
</body>
</html>